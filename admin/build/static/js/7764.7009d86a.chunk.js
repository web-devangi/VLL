"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[7764],{89281:(e,t,s)=>{s.d(t,{h:()=>u});var a=s(47313),r=s(12279),l=s.n(r),n=s(74294),d=s(72652),i=s(46417);const u=e=>{let{fetchOptions:t,debounceTimeout:s=400,onClear:r,refetchOptions:u=!1,...c}=e;const[o,m]=(0,a.useState)(!1),[p,h]=(0,a.useState)([]),v=(0,a.useMemo)((()=>l()((e=>{h([]),m(!0),t(e).then((e=>{h(e),m(!1)}))}),s)),[t,s]);return(0,i.jsx)(n.Z,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:v,onClear:()=>{v(""),r&&r()},notFoundContent:o?(0,i.jsx)(d.Z,{size:"small"}):"no results",...c,options:p,onFocus:()=>{p.length&&!u||v("")}})}},81742:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(34344);const r={getAll:e=>a.Z.get("dashboard/seller/stocks/select-paginate",{params:e})}},57764:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(47313),r=s(97890),l=s(23560),n=s(10976),d=s(77181),i=s(68197),u=s(59624),c=s(74294),o=s(16124),m=s(99096),p=s(59491),h=s(70816),v=s.n(h),f=s(2717),x=s(90954),Z=s(57409),Y=s(69660),g=s(89281),j=s(24511),y=s(8550),b=s(5764),M=s(51282),D=s(81742),q=s(46417);function N(){var e,t;const{t:s}=(0,j.$)(),{activeMenu:h}=(0,f.v9)((e=>e.menu),f.wU),N=(0,f.I0)(),{id:S}=(0,r.UO)(),[k]=n.Z.useForm(),w=(0,r.s0)(),[I,O]=(0,a.useState)(!1),[C,F]=(0,a.useState)(!1),{myShop:A}=(0,f.v9)((e=>e.myShop),f.wU),[U,V]=(0,a.useState)(null!==(e=h.data)&&void 0!==e&&e.images?[null===(t=h.data)||void 0===t?void 0:t.images[0]]:[]);(0,a.useEffect)((()=>()=>{const e=k.getFieldsValue(!0),t=JSON.stringify(e.start),s=JSON.stringify(e.end),a={...e,start:t,end:s};N((0,x.nc)({activeMenu:h,data:a}))}),[]),(0,a.useEffect)((()=>{h.refetch&&(F(!0),Z.Z.getById(S).then((e=>{let{data:t}=e;const s={price:t.price,type:t.type,products:t.stocks.map((e=>{var t,s;return{label:null===e||void 0===e||null===(t=e.product)||void 0===t||null===(s=t.translation)||void 0===s?void 0:s.title,value:e.id,key:e.id}})),start:v()(t.start,"YYYY-MM-DD"),end:v()(t.end,"YYYY-MM-DD"),image:[(0,y.Z)(t.img)]};k.setFieldsValue(s),V([(0,y.Z)(t.img)])})).finally((()=>{F(!1),N((0,x.A_)(h))})))}),[h.refetch]);return(0,q.jsx)(d.Z,{title:s("edit.discount"),className:"h-100",children:C?(0,q.jsx)(M.Z,{}):(0,q.jsxs)(n.Z,{name:"discount-add",layout:"vertical",onFinish:e=>{var t;if(v()(e.start).format("YYYY-MM-DD")>v()(e.end).format("YYYY-MM-DD"))return l.Am.error(s("start.date.must.be.before.end.date"));const a={price:e.price,type:e.type,stocks:e.products.map((e=>e.value)),start:e.start?v()(e.start).format("YYYY-MM-DD"):void 0,end:e.end?v()(e.end).format("YYYY-MM-DD"):void 0,images:[null===(t=U[0])||void 0===t?void 0:t.name]};O(!0);const r="seller/discounts";Z.Z.update(S,a).then((()=>{l.Am.success(s("successfully.updated")),(0,f.dC)((()=>{N((0,x.ph)({...h,nextUrl:r})),N((0,Y.k)({}))})),w("/".concat(r))})).finally((()=>O(!1)))},form:k,initialValues:{...(()=>{var e;const t=h.data;if(null===(e=h.data)||void 0===e||!e.start)return t;const s=h.data.start,a=h.data.end;return{...t,start:v()(s,"YYYY-MM-DD"),end:v()(a,"YYYY-MM-DD")}})(),...h.data},className:"d-flex flex-column h-100",children:[(0,q.jsxs)(i.Z,{gutter:12,children:[(0,q.jsx)(u.Z,{span:12,children:(0,q.jsx)(n.Z.Item,{label:s("type"),name:"type",rules:[{required:!0,message:s("required")}],children:(0,q.jsxs)(c.Z,{children:[(0,q.jsx)(c.Z.Option,{value:"fix",children:s("fix")}),(0,q.jsx)(c.Z.Option,{value:"percent",children:s("percent")})]})})}),(0,q.jsx)(u.Z,{span:12,children:(0,q.jsx)(n.Z.Item,{label:s("price"),name:"price",rules:[{required:!0,message:s("required")}],children:(0,q.jsx)(o.Z,{min:0,className:"w-100"})})}),(0,q.jsx)(u.Z,{span:12,children:(0,q.jsx)(n.Z.Item,{label:s("start.date"),name:"start",rules:[{required:!0,message:s("required")}],valuePropName:"date",children:(0,q.jsx)(m.Z,{className:"w-100",placeholder:"",disabledDate:e=>v()().add(-1,"days")>=e})})}),(0,q.jsx)(u.Z,{span:12,children:(0,q.jsx)(n.Z.Item,{label:s("end.date"),name:"end",rules:[{required:!0,message:s("required")}],valuePropName:"date",children:(0,q.jsx)(m.Z,{className:"w-100",placeholder:"",disabledDate:e=>v()().add(-1,"days")>=e})})}),(0,q.jsx)(u.Z,{span:24,children:(0,q.jsx)(n.Z.Item,{label:s("products"),name:"products",rules:[{required:!0,message:s("required")}],children:(0,q.jsx)(g.h,{fetchOptions:async function(e){const t={search:e,shop_id:A.id,status:"published",active:1,rest:1};return D.Z.getAll(t).then((e=>e.data.map((e=>{var t,s;return{label:null===e||void 0===e||null===(t=e.product)||void 0===t||null===(s=t.translation)||void 0===s?void 0:s.title,value:e.id,key:e.id}}))))},mode:"multiple"})})}),(0,q.jsx)(u.Z,{span:24,children:(0,q.jsx)(n.Z.Item,{label:s("image"),name:"images",rules:[{required:!U.length,message:s("required")}],children:(0,q.jsx)(b.Z,{type:"discounts",imageList:U,setImageList:V,form:k,multiple:!1,name:"image"})})})]}),(0,q.jsx)("div",{className:"flex-grow-1 d-flex flex-column justify-content-end",children:(0,q.jsx)("div",{className:"pb-5",children:(0,q.jsx)(p.Z,{type:"primary",htmlType:"submit",loading:I,children:s("submit")})})})]})})}}}]);
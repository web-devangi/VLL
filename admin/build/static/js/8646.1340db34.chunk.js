"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[8646],{8646:function(e,s,n){n.r(s),n.d(s,{default:function(){return O}});var a=n(15861),t=n(29439),i=n(87757),r=n.n(i),c=n(47313),l=(n(32220),n(49339)),o=n(70816),u=n.n(o),d=n(46417),m=function(e){var s=e.date,n=u()(s,"DD-MM-YYYY").isSame(u()(),"day");return(0,d.jsx)("div",{className:"chat-date","data-date":n?"Today":u()(s,"DD-MM-YYYY").format("D MMM")})},g=n(3394),f=n(26672),v=n(22539),h=n(54972),x=n(67251),p=n(78267),j=n(2717),y=n(62670);var N=function(e){var s=e.replyMessage;return(0,d.jsx)("div",{className:"reply-message",children:"image"!==s.type?(0,d.jsx)("p",{className:"reply-message__text",children:s.message}):(0,d.jsx)("img",{className:"reply-message__image",src:s.message,alt:s.message})})},M=function(e){var s=e.data,n=e.onActionMessage,a=e.onDeleteMessage,i=s.type,r=s.time,o=s.message,m=(s.status,s.read),M=s.replyDocId,Z=(0,j.v9)((function(e){var s,n;return null===(s=e.chat)||void 0===s||null===(n=s.currentChat)||void 0===n?void 0:n.chatId})),b=(0,c.useState)(null),I=(0,t.Z)(b,2),k=I[0],C=I[1],w=(0,d.jsxs)(x.Z,{onClick:function(e){var s=e.key;return"delete"===s?a():n(s)},children:[(0,d.jsx)(x.Z.Item,{icon:(0,d.jsx)(f.Bjt,{}),children:"Reply"},"reply"),"image"!==i&&(0,d.jsx)(x.Z.Item,{icon:(0,d.jsx)(v.cqP,{}),children:"Edit"},"edit"),(0,d.jsx)(x.Z.Item,{icon:(0,d.jsx)(h.AWu,{}),danger:!0,children:"Delete"},"delete")]});return(0,c.useEffect)((function(){if(M)return(0,y._8)(M,Z,C)}),[]),(0,d.jsx)("div",{className:"admin-message-wrapper",children:(0,d.jsxs)("div",{className:"admin-message ".concat("image"===i&&"chat-image"),children:[(0,d.jsx)(p.Z,{overlay:w,trigger:["contextMenu"],children:(0,d.jsxs)("div",{children:[k&&(0,d.jsx)(N,{replyMessage:k}),"image"===i?(0,d.jsx)(l.v0,{type:"image",model:{direction:"incoming",payload:{src:o,alt:"Image",width:"100%",height:"100%"}}}):(0,d.jsx)("div",{className:"text",children:o})]})}),(0,d.jsx)("div",{className:"time",children:u()(new Date(r)).format("HH:mm")}),(0,d.jsx)("span",{className:"double-check",children:m?(0,d.jsx)(g.NNX,{size:16}):(0,d.jsx)(g.vYr,{size:16})})]})})},Z=function(e){var s=e.data,n=e.onActionMessage,a=s.time,i=s.message,r=s.type,o=s.replyDocId,m=(0,j.v9)((function(e){var s,n;return null===(s=e.chat)||void 0===s||null===(n=s.currentChat)||void 0===n?void 0:n.chatId})),g=(0,c.useState)(null),v=(0,t.Z)(g,2),h=v[0],M=v[1],Z=(0,d.jsx)(x.Z,{onClick:function(e){var s=e.key;n(s)},children:(0,d.jsx)(x.Z.Item,{icon:(0,d.jsx)(f.Bjt,{}),children:(0,d.jsx)("div",{className:"w-100",children:"Reply"})},"reply")});return(0,c.useEffect)((function(){if(o)return(0,y._8)(o,m,M)}),[]),(0,d.jsx)("div",{className:"user-sms-wrapper",children:(0,d.jsxs)("div",{className:"user-message ".concat("image"===r&&"chat-image"),children:[(0,d.jsx)(p.Z,{overlay:Z,trigger:["contextMenu"],children:(0,d.jsxs)("div",{children:[h&&(0,d.jsx)(N,{replyMessage:h}),"image"===r?(0,d.jsx)(l.v0,{type:"image",model:{direction:"incoming",payload:{src:i,alt:"Image",width:"100%",height:"100%"}}}):(0,d.jsx)("div",{className:"text",children:i})]})}),(0,d.jsx)("div",{className:"time",children:u()(new Date(a)).format("HH:mm")})]})})};function b(e){var s=e.groupMessages,n=e.messageEndRef,a=e.handleActionMessage,t=e.handleDelete;return(0,d.jsxs)("div",{className:"chat-box",children:[s.map((function(e,s){return(0,d.jsxs)("div",{children:["Invalid date"!==e.date?(0,d.jsx)(m,{date:e.date}):"",(0,d.jsx)("div",{className:"sms-box",children:e.messages.map((function(e){return Boolean(e.sender)?(0,d.jsx)(Z,{data:e,onActionMessage:function(s){return a(s,e)}},e.id):(0,d.jsx)(M,{data:e,onActionMessage:function(s){return a(s,e)},onDeleteMessage:function(){return t(e)}},e.id)}))})]},s)})),(0,d.jsx)("div",{ref:n})]})}var I=n(84232),k=n(39796);Math.easeInOutQuad=function(e,s,n,a){return(e/=a/2)<1?n/2*e*e+s:-n/2*(--e*(e-2)-1)+s};var C=n(24511),w=n(69658),_=n(74580),D=n(85711),S=n(23560),A=n(9274),R=n(59491),E=n(36104),T=n(51282),U=function(e){var s=e.modal,n=e.url,a=e.setModal,i=(e.setPercent,e.file),r=e.handleOnSubmit,l=function(){return a(!s)},o=(0,c.useState)(!1),u=(0,t.Z)(o,2),m=u[0],g=u[1];return(0,d.jsx)(A.Z,{visible:s,footer:!1,onOk:l,onCancel:l,children:(0,d.jsxs)("div",{className:"upload-form position-relative",children:[m&&(0,d.jsx)("div",{className:"position-absolute h-100 w-100 d-flex justify-content-center align-items-center bg-transparent",children:(0,d.jsx)(T.Z,{})}),(0,d.jsx)("img",{src:n}),(0,d.jsxs)("div",{className:"footer-btns",children:[(0,d.jsx)(R.Z,{disabled:m,onClick:l,children:"Cancel"}),(0,d.jsx)(R.Z,{disabled:m,onClick:function(){if(g(!0),!i)return S.Am.error("Please upload an image first!");var e=new FormData;e.append("image",i),e.append("type","users"),E.Z.upload(e).then((function(e){r({type:"image",message:e.data.title})})).catch((function(e){return console.error(e)})).finally((function(){g(!1),a(!1)}))},children:"Send"})]})]})})},Y=n(97421);var z,B=function(e){var s=e.actionMessage,n=e.cancelMessageAction;return(0,d.jsxs)("div",{style:{top:"calc(100% - ".concat("image"===s.message.type?88:53,"px)")},className:"message-actions-wrapper",children:[(0,d.jsxs)("div",{className:"message-actions__content",children:[(0,d.jsx)("span",{className:"message-actions__type",children:s.actionType}),"image"===s.message.type?(0,d.jsx)("img",{className:"message-actions__image",alt:s.message.message,src:s.message.message}):(0,d.jsx)("p",{className:"message-actions__message",children:s.message.message})]}),(0,d.jsx)("button",{className:"message-actions__close-btn",onClick:n,children:(0,d.jsx)(g.R5A,{size:20})})]})};function O(){var e,s,n,i,o=(0,C.$)().t,u=(0,c.useRef)(),m=(0,c.useRef)(),g=(0,j.I0)(),f=(0,c.useRef)(),v=(0,c.useContext)(_._).setIsModalVisible,h=(0,c.useState)(""),x=(0,t.Z)(h,2),p=x[0],N=x[1],M=(0,c.useState)(""),Z=(0,t.Z)(M,2),A=Z[0],R=Z[1],E=(0,c.useState)(!1),T=(0,t.Z)(E,2),O=T[0],H=T[1],q=(0,j.v9)((function(e){return e.auth.user.id})),P=(0,j.v9)((function(e){return e.chat}),j.wU),$=P.chats,F=P.currentChat,G=P.messagesLoading,L=P.chatInitialized,Q=P.authUserId,W=(0,j.v9)((function(e){return(0,k._U)(e.chat.messages)}),j.wU),V=(0,c.useState)(""),X=(0,t.Z)(V,2),J=X[0],K=X[1],ee=(0,c.useState)({actionType:null,message:null}),se=(0,t.Z)(ee,2),ne=se[0],ae=se[1],te=(0,c.useRef)();(0,c.useEffect)((function(){u.current&&u.current.focus()}),[u,F]),(0,c.useEffect)((function(){var e;if(L){if(q!==Q){var s;null===(s=z)||void 0===s||s(),(0,j.dC)((function(){g((0,I.Rm)()),g((0,I.Nv)([])),g((0,I.Z)([])),g((0,I.vu)(q))})),z=(0,y.mb)(q)}}else null===(e=z)||void 0===e||e(),z=(0,y.mb)(q),(0,j.dC)((function(){g((0,I.vu)(q)),g((0,I.zU)(!0))}))}),[q]);var ie=function(){var e=f.current.offsetTop;!function(e,s,n){var a=e.scrollTop,t=s-a,i=0;!function s(){i+=20;var r=Math.easeInOutQuad(i,a,t,n);e.scrollTop=r,i<n&&setTimeout(s,20)}()}(document.querySelector(".message-list .scrollbar-container"),e-30,600)},re=function(){var e=(0,a.Z)(r().mark((function e(s){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K(""),"reply"===ne.actionType&&(s.replyDocId=ne.message.id),"edit"!==ne.actionType){e.next=7;break}return e.next=5,(0,y.Hd)(q,F.chatId,s,ne);case 5:e.next=10;break;case 7:return ie(),e.next=10,(0,y.bG)(q,F.chatId,s);case 10:le();case 11:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),ce=function(){var e=(0,a.Z)(r().mark((function e(){var s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.GO)(F.chatId);case 2:W.forEach((function(e){e.messages.forEach((function(e){return(0,y.$Z)(F.chatId,e.id)}))})),null===(s=te.current)||void 0===s||s.call(te),(0,j.dC)((function(){g((0,I.Rm)()),g((0,I.Z)([]))})),v(!1),le();case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var le=function(){var e;ae({actionType:null,message:null}),J&&K(""),null===(e=u.current)||void 0===e||e.focus()};return(0,d.jsxs)("div",{style:{height:"80vh"},children:[(0,d.jsx)("input",{type:"file",ref:m,onChange:function(e){if(Y.zb.includes(e.target.files[0].type)){N(e.target.files[0]);var s=new FileReader;s.onload=function(){2===s.readyState&&(R(s.result),H(!0))},null===s||void 0===s||s.readAsDataURL(e.target.files[0])}else S.Am.error("Supported only image formats!")},accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/svg",className:"d-none"}),(0,d.jsxs)(l.tz,{responsive:!0,className:"chat-container rounded",children:[(0,d.jsx)(l.YE,{position:"left",scrollable:!1,className:"chat-sidebar",children:(0,d.jsx)(l.p7,{children:$.filter((function(e){return void 0!==e.user.id})).map((function(e,s){var n,a;return(0,d.jsx)(l.ri,{onClick:function(){!function(e){te.current&&te.current(),(0,j.dC)((function(){g((0,I.sN)(!0)),g((0,I.eb)(e))})),te.current=(0,y.W4)(e.chatId,q),le()}(e)},name:e.user.firstname+" "+(e.user.lastname||""),info:e.lastMessage,children:(0,d.jsx)(l.qE,{src:(0,D.Z)(null===(n=e.user)||void 0===n?void 0:n.img),name:null===(a=e.user)||void 0===a?void 0:a.firstname})},s)}))})}),(0,d.jsxs)(l.uU,{className:"chat-container",children:[F?(0,d.jsxs)(l.BU,{className:"chat-header",children:[(0,d.jsx)(l.BU.Back,{}),(0,d.jsx)(l.qE,{src:(0,D.Z)(null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.img),name:null===F||void 0===F||null===(s=F.user)||void 0===s?void 0:s.firstname}),(0,d.jsx)(l.BU.Content,{userName:"".concat(null===F||void 0===F||null===(n=F.user)||void 0===n?void 0:n.firstname," ").concat((null===F||void 0===F||null===(i=F.user)||void 0===i?void 0:i.lastname)||"")})]}):"",(0,d.jsxs)(l.rN,{loading:G,className:"message-list",children:[(0,d.jsx)(b,{groupMessages:W,messageEndRef:f,handleActionMessage:function(e,s){var n;ae({actionType:e,message:s}),"edit"===e&&K(s.message),null===(n=u.current)||void 0===n||n.focus()},handleDelete:function(e){var s,n,a,t,i=(null===W||void 0===W||null===(s=W.at(-1))||void 0===s||null===(n=s.messages)||void 0===n?void 0:n.at(-2))||(null===W||void 0===W||null===(a=W.at(-2))||void 0===a||null===(t=a.messages)||void 0===t?void 0:t.at(-1));(0,y.$Z)(F.chatId,e,i).then()}}),ne.message&&(0,d.jsx)(B,{actionMessage:ne,cancelMessageAction:le})]}),W.length?(0,d.jsx)(l.Ru,{ref:u,value:J,onChange:function(e){K(e)},onSend:function(e){return re({message:e.replace(/\&nbsp;/g,"").replace(/<[^>]+>/g,"").trim()})},placeholder:"Message",className:"chat-input",onAttachClick:function(){m.current.click()}}):null]})]}),(0,d.jsx)(U,{modal:O,url:A,setModal:H,file:p,handleOnSubmit:re}),(0,d.jsx)(w.Z,{click:ce,text:o("delete.chat")})]})}}}]);
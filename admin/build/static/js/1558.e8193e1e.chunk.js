"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[1558],{89802:(e,t,l)=>{l.d(t,{q:()=>d});var i=l(47313),s=l(74294),r=l(72652),n=l(46417);const d=e=>{let{fetchOptions:t,refetch:l=!1,value:d,...a}=e;const[o,c]=(0,i.useState)(!1),[u,v]=(0,i.useState)([]);"object"===typeof(null===d||void 0===d?void 0:d.label)&&null!==(null===d||void 0===d?void 0:d.label)&&(d.label=d.label.value);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.Z,{labelInValue:!0,filterOption:!1,notFoundContent:o?(0,n.jsx)(r.Z,{size:"small"}):"no results",value:d,...a,options:o?[]:u,onFocus:()=>{u.length&&!l||(c(!0),t().then((e=>{v(e),c(!1)})))}})})}},4014:(e,t,l)=>{function i(e){var t,l;let i=null===e||void 0===e?void 0:e.slice(0,1),s=null===e||void 0===e?void 0:e.lastIndexOf("@"),r=null===e||void 0===e?void 0:e.slice(1,s-1);r=null===(t=r)||void 0===t?void 0:t.replace(/./g,"*");let n=null===e||void 0===e?void 0:e.slice(s-1,e.length);return null===i||void 0===i||null===(l=i.concat(r))||void 0===l?void 0:l.concat(n)}l.d(t,{Z:()=>i})},84261:(e,t,l)=>{function i(e){const t="".concat(e),l="*".repeat(t.length-2);return(null===t||void 0===t?void 0:t[0])+l+(null===t||void 0===t?void 0:t[(null===t||void 0===t?void 0:t.length)-1])}l.d(t,{Z:()=>i})},51988:(e,t,l)=>{l.d(t,{Z:()=>o});l(47313);var i=l(24511),s=l(66188);const r=l.p+"static/media/noproductsfound.1cec73868b5fd048b865.riv",n=l.p+"static/media/noresult.ac4af107751f94856a9c.riv",d=l.p+"static/media/nosell.32cb2c2cc548a15c820d.riv";var a=l(46417);const o=function(e){let{id:t="noresult",text:l=""}=e;const{t:o}=(0,i.$)(),c={src:{noproductsfound:r,noresult:n,nosell:d}[t],artboard:"New Artboard",autoplay:!0},{RiveComponent:u}=(0,s.useRive)(c);return(0,a.jsxs)("div",{className:"animation-canvas",children:[(0,a.jsx)("div",{style:{width:"100%",height:200},children:(0,a.jsx)(u,{})}),(0,a.jsx)("div",{className:"text",children:o(l)})]})}},41481:(e,t,l)=>{l.d(t,{Z:()=>a});var i=l(47313),s=l(66672),r=l(16031),n=l(40765),d=l(46417);function a(e){let{handleChange:t,defaultValue:l,resetSearch:a,...o}=e;const[c,u]=(0,i.useState)(l),v=(0,i.useMemo)((()=>(0,r.debounce)((e=>{t(e)}),800)),[]);return(0,i.useEffect)((()=>{u(l)}),[a]),(0,d.jsx)(s.Z,{value:c,onChange:e=>{u(e.target.value),v(e.target.value)},prefix:(0,d.jsx)(n.Z,{}),...o})}},89281:(e,t,l)=>{l.d(t,{h:()=>o});var i=l(47313),s=l(12279),r=l.n(s),n=l(74294),d=l(72652),a=l(46417);const o=e=>{let{fetchOptions:t,debounceTimeout:l=400,onClear:s,refetchOptions:o=!1,...c}=e;const[u,v]=(0,i.useState)(!1),[h,p]=(0,i.useState)([]),x=(0,i.useMemo)((()=>r()((e=>{p([]),v(!0),t(e).then((e=>{p(e),v(!1)}))}),l)),[t,l]);return(0,a.jsx)(n.Z,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:x,onClear:()=>{x(""),s&&s()},notFoundContent:u?(0,a.jsx)(d.Z,{size:"small"}):"no results",...c,options:h,onFocus:()=>{h.length&&!o||x("")}})}},77370:(e,t,l)=>{function i(e,t){for(var l=[],i=[],s="",r=0;r<(null===(n=e.stocks)||void 0===n?void 0:n.length);r++){var n;s="",e.stocks[r].extras.sort(((e,t)=>e.extra_group_id-t.extra_group_id));for(var d=0;d<(null===(a=e.stocks[r].extras)||void 0===a?void 0:a.length);d++){var a,o=Object.assign({},e.stocks[r].extras[d]),c=l.findIndex((e=>e.extra_value_id==o.extra_value_id));-1==c?(o.level=d,o.up=[s],l.push(o),s+=o.extra_value_id.toString()):(l[c].up.push(s),s+=o.extra_value_id.toString())}var u={id:e.stocks[r].id,extras:s,price:e.stocks[r].price,quantity:e.stocks[r].quantity,countable_id:e.stocks[r].countable_id,discount:e.stocks[r].discount,tax:e.stocks[r].tax,total_price:e.stocks[r].total_price,bonus:e.stocks[r].bonus};i.push(u)}return{stock:i,extras:l}}function s(e,t,l){for(var i=""==e?[]:e.split(","),s=[],r=[],n=0;n<=i.length;n++){n-1>=0&&(r[r.length]=i[n-1].toString());var d=t.filter((e=>{if(new Set(e.up).has(r.join("")))return e}));d.length>0&&s.push(d)}n=0;if(r.length<s.length)for(;n<t.length;){r[r.length]=s[s.length-1][0].extra_value_id.toString();let e=t.filter((e=>!!new Set(e.up).has(r.join(""))));if(0==e.length)break;s.push(e),n++}var a=l.findIndex((e=>e.extras==r.join("")));return{stock:l[a],extras:s}}l.d(t,{o:()=>i,y:()=>s})},28939:(e,t,l)=>{function i(e){var t;const l=null===e||void 0===e||null===(t=e.extras)||void 0===t?void 0:t.find((e=>"image"===e.group.type));return l?l.value:""}l.d(t,{Z:()=>i})},84017:(e,t,l)=>{function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"after";const i=Number(e).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");return"after"===l?"".concat(i," ").concat(t):"".concat(t," ").concat(i)}l.d(t,{Z:()=>i})},91220:(e,t,l)=>{function i(e,t){var l;const i=(null===t||void 0===t||null===(l=t.translation)||void 0===l?void 0:l.title)||"pcs";if(!e)return 0;switch(null===t||void 0===t?void 0:t.position){case"after":return e+" "+i;case"before":return i+" "+e}}l.d(t,{Z:()=>i})},11101:(e,t,l)=>{l.d(t,{Z:()=>s});var i=l(34344);const s={getAll:e=>i.Z.get("rest/brands/paginate",{params:e}),getById:(e,t)=>i.Z.get("rest/brands/".concat(e),{params:t})}},29955:(e,t,l)=>{l.d(t,{Z:()=>s});var i=l(34344);const s={getAll:e=>i.Z.get("dashboard/seller/categories/paginate",{params:e}),getById:(e,t)=>i.Z.get("dashboard/seller/categories/".concat(e),{params:t}),search:e=>i.Z.get("dashboard/seller/categories/search",{params:e}),paginateSelect:e=>i.Z.get("dashboard/seller/categories/select-paginate",{params:e})}},21448:(e,t,l)=>{l.d(t,{Z:()=>s});var i=l(34344);const s={checkCoupon:e=>i.Z.post("rest/coupons/check",e),checkCashback:e=>i.Z.post("rest/cashback/check",e)}},7605:(e,t,l)=>{l.r(t),l.d(t,{default:()=>xe});var i=l(47313),s=l(10976),r=l(256),n=l(59491),d=l(68197),a=l(59624),o=l(72652),c=l(77181),u=l(74294),v=l(66672),h=l(16031),p=l(49986),x=l(89281),m=l(2717),y=l(73270),j=l(24511),f=l(55768),Z=l(90954),g=l(97890),_=l(23560),b=l(89802),k=l(26457),N=l(46417);const S=e=>{let{form:t}=e;const{t:l}=(0,j.$)(),r=(0,m.I0)(),o=(0,g.s0)(),{data:S}=(0,m.v9)((e=>e.order),m.wU),{currencies:w}=(0,m.v9)((e=>e.currency),m.wU),[I,C]=(0,i.useState)([]),[q,M]=(0,i.useState)(!1);return(0,N.jsx)(c.Z,{title:l("customer.details"),children:(0,N.jsxs)(d.Z,{gutter:12,children:[(0,N.jsx)(a.Z,{span:16,children:(0,N.jsx)(s.Z.Item,{label:l("client"),name:"user",rules:[{required:!0,message:""}],children:(0,N.jsx)(x.h,{placeholder:l("select.client"),fetchOptions:async function(e){const t={search:e,perPage:10};return p.Z.search(t).then((e=>{let{data:t}=e;return C(t),function(e){if(!e)return;return(0,h.isArray)(e)?e.map((e=>({label:"".concat(e.firstname," ").concat(e.lastname||""),value:e.id}))):{label:"".concat(e.firstname," ").concat(e.lastname||""),value:e.id}}(t)}))},onSelect:function(e){const l=I.find((t=>t.id===e.value));r((0,y.oM)({user:e,userUuid:l.uuid})),t.setFieldsValue({address:null}),M(!0)}})})}),(0,N.jsx)(a.Z,{span:8,children:(0,N.jsx)(s.Z.Item,{label:"add",className:"label-hidden",children:(0,N.jsx)(n.Z,{icon:(0,N.jsx)(f.Z,{}),onClick:()=>{r((0,Z.bL)({url:"user/add",id:"user_add",name:"User add"})),o("/user/add")},children:l("add")})})}),(0,N.jsx)(a.Z,{span:16,children:(0,N.jsx)(s.Z.Item,{label:l("address"),name:"address",rules:[{required:!0,message:""}],children:(0,N.jsx)(b.q,{fetchOptions:()=>async function(e){return e?(M(!1),p.Z.getById(e).then((e=>{let{data:t}=e;return t.addresses.map((e=>({label:e.address,value:e.id})))}))):[]}(S.userUuid),onSelect:e=>r((0,y.oM)({address:e})),refetch:q,className:"w-100",placeholder:l("select.address")})})}),(0,N.jsx)(a.Z,{span:8,children:(0,N.jsx)(s.Z.Item,{label:"add",className:"label-hidden",children:(0,N.jsx)(n.Z,{icon:(0,N.jsx)(f.Z,{}),onClick:()=>{S.userUuid?(r((0,Z.bL)({url:"user/".concat(S.userUuid),id:"user_edit",name:"User edit"})),o("/user/".concat(S.userUuid))):_.Am.warning("Please, select client")},children:l("add")})})}),(0,N.jsx)(a.Z,{span:12,children:(0,N.jsx)(s.Z.Item,{label:l("currency"),name:"currency_id",rules:[{required:!0,message:"missing_currency"}],children:(0,N.jsx)(u.Z,{placeholder:l("select.currency"),onSelect:function(e){const t=w.find((t=>t.id===e));r((0,y.dY)(t))},children:w.map(((e,t)=>(0,N.jsxs)(u.Z.Option,{value:e.id,children:[e.title," (",null===e||void 0===e?void 0:e.symbol,")"]},t)))})})}),(0,N.jsx)(a.Z,{span:12,children:(0,N.jsx)(s.Z.Item,{label:l("payment.type"),name:"payment_type",rules:[{required:!0,message:l("missing.payment.type")}],children:(0,N.jsx)(b.q,{fetchOptions:async function(){return k.Z.getAll({perPage:100}).then((e=>{let{data:t}=e;return t.filter((e=>"cash"===e.tag||"terminal"===e.tag)).map((e=>{var t;return{label:(null===(t=e.translation)||void 0===t?void 0:t.title)||"no name",value:e.id}}))}))},className:"w-100",placeholder:l("select.payment.type")})})}),(0,N.jsx)(a.Z,{span:24,children:(0,N.jsx)(s.Z.Item,{label:l("note"),name:"note",children:(0,N.jsx)(v.Z,{})})})]})})};var w=l(99096),I=l(16124),C=l(49067),q=l(80314),M=l(70816),H=l.n(M),O=l(51988);const U=e=>{let{form:t}=e;const{t:l}=(0,j.$)(),r=(0,m.I0)(),{orderShops:n,data:v}=(0,m.v9)((e=>e.order),m.wU),h=(0,m.v9)((e=>e.menu.activeMenu),m.wU),{data:p}=h,[x,y]=(0,i.useState)(!1);function f(e){y(!0);const t=function(e){const t=e.map(((e,t)=>({["shops[".concat(t,"]")]:e.id})));return Object.assign({},...t)}(e);C.Z.getShopDeliveries(t).then((e=>r((0,Z.nc)({activeMenu:h,data:e.data})))).finally((()=>y(!1)))}function g(e){if(!e)return[];let t=[];const l=H()(e.open_time,"HH:mm").hour(),i=H()(e.close_time,"HH:mm").hour();for(let s=l+1;s<i;s++){const e={label:H()(s,"HH").format("HH:mm"),value:H()(s,"HH").format("HH:mm")};t.push(e)}return t}return(0,i.useEffect)((()=>{if(null!==p&&void 0!==p&&p.length){if(v.deliveries.length)return void t.setFieldsValue({deliveries:(e=p,l=v.deliveries,e.map((e=>{const t=l.find((t=>t.shop_id===e.id));return t?{shop_id:e.id,delivery:t.delivery,delivery_date:H()(t.delivery_date),delivery_time:t.delivery_time,delivery_fee:t.delivery_fee}:{shop_id:e.id,delivery:"",delivery_date:"",delivery_time:"",delivery_fee:""}})))});t.setFieldsValue({deliveries:p.map((e=>({shop_id:e.id,delivery:"",delivery_date:"",delivery_time:"",delivery_fee:""})))})}else t.setFieldsValue({deliveries:[]});var e,l}),[p]),(0,q.Z)((()=>{n.length&&f(n)}),[n]),(0,N.jsxs)(c.Z,{title:l("stores"),children:[x&&(0,N.jsx)("div",{className:"loader",children:(0,N.jsx)(o.Z,{})}),(0,N.jsx)(s.Z.List,{name:"deliveries",children:e=>(0,N.jsx)("div",{children:e.length?e.map(((e,t)=>{var i,r,n,o;return(0,N.jsx)(c.Z,{title:"".concat(null===(i=p[t])||void 0===i||null===(r=i.translation)||void 0===r?void 0:r.title," ").concat(l("shop")),type:"inner",size:"small",children:(0,N.jsxs)(d.Z,{gutter:12,children:[(0,N.jsx)(a.Z,{span:24,children:(0,N.jsx)(s.Z.Item,{name:[t,"delivery"],label:l("delivery"),rules:[{required:!0,message:l("required.field")}],children:(0,N.jsx)(u.Z,{placeholder:l("select.delivery"),options:(o=null===(n=p[t])||void 0===n?void 0:n.deliveries,null!==o&&void 0!==o&&o.length?o.map((e=>{var t;return{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}})):[]),labelInValue:!0})})}),(0,N.jsx)(a.Z,{span:24,children:(0,N.jsxs)(d.Z,{gutter:12,children:[(0,N.jsx)(a.Z,{span:12,children:(0,N.jsx)(s.Z.Item,{name:[t,"delivery_date"],label:l("delivery.date"),rules:[{required:!0,message:l("required.field")}],children:(0,N.jsx)(w.Z,{className:"w-100"})})}),(0,N.jsx)(a.Z,{span:12,children:(0,N.jsx)(s.Z.Item,{label:"".concat(l("delivery.time")," (").concat(l("up.to"),")"),name:[t,"delivery_time"],rules:[{required:!0,message:l("required.field")}],children:(0,N.jsx)(u.Z,{options:g(p[t])})})}),(0,N.jsx)(a.Z,{span:12,children:(0,N.jsx)(s.Z.Item,{label:l("delivery.fee"),name:[t,"delivery_fee"],hidden:!0,children:(0,N.jsx)(I.Z,{min:0,className:"w-100"})})})]})})]})},e.key)})):(0,N.jsx)(d.Z,{children:(0,N.jsx)(a.Z,{span:24,children:(0,N.jsx)(O.Z,{id:"nosell"})})})})})]})};var V=l(45705),F=l(11101),z=l(29955),E=l(11875),Y=l(45464),P=l(82138),A=l(11829),B=l(43681),T=l(83371),$=l(90046);function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],l=0;const i=t.find((t=>t.shop_id===e.id));null!==i&&void 0!==i&&i.delivery_fee&&(l=i.delivery_fee);const s=e.products.reduce(((e,t)=>e+t.total_price),0),r=e.products.reduce(((e,t)=>e+t.tax),0),n=e.products.reduce(((e,t)=>e+t.shop_tax),0),d=s+n+l,a=n+r;return{productTax:r,shopTax:n,total:d,deliveryFee:l,orderTax:a}}var W=l(9274),R=l(26824),L=l(8846),Q=l(84017),X=l(28939),G=l(77370),J=l(91220);function K(e){var t,l,r,o,c,u,v;let{extrasModal:h,setExtrasModal:p}=e;const[x,j]=(0,i.useState)(h.stock),[f,Z]=(0,i.useState)(h.quantity||h.min_qty),[g,b]=(0,i.useState)([]),[k,S]=(0,i.useState)([]),[w,I]=(0,i.useState)(null),[C,q]=(0,i.useState)([]),{currency:M}=(0,m.v9)((e=>e.order.data),m.wU),[H]=s.Z.useForm(),O=(0,m.I0)();(0,i.useEffect)((()=>{null!==w&&void 0!==w&&w.stock&&j({...w.stock,extras:C})}),[w]),(0,i.useEffect)((()=>{var e;const t=(0,G.o)(h);b(t.extras),S(t.stock),I((0,G.y)("",t.extras,t.stock)),null===(e=(0,G.y)("",t.extras,t.stock).extras)||void 0===e||e.forEach((e=>{q((t=>[...t,e[0]]))}))}),[h]);const U=e=>{var t;const l=C.findIndex((t=>t.extra_group_id===e.extra_group_id));let i=C;l>-1&&(i=i.slice(0,l)),i.push(e);const s=i.map((e=>e.id)).join(",");var r=(0,G.y)(s,g,k);I(r),null===(t=r.extras)||void 0===t||t.forEach((t=>{const l=C.findIndex((l=>t[0].extra_group_id!=e.extra_group_id?l.extra_group_id===t[0].extra_group_id:l.extra_group_id===e.extra_group_id));if(t[0].level>=e.level){var s=t[0].extra_group_id!=e.extra_group_id?t[0]:e;-1==l?i.push(s):i[l]=s}})),q(i)},F=()=>{p(!1)};return(0,N.jsx)(W.Z,{visible:!!h,title:null===(t=h.translation)||void 0===t?void 0:t.title,onCancel:F,footer:[(0,N.jsx)(n.Z,{type:"primary",onClick:()=>H.submit(),children:"Add"}),(0,N.jsx)(n.Z,{type:"default",onClick:F,children:"Cancel"})],children:(0,N.jsxs)(s.Z,{form:H,layout:"vertical",onFinish:e=>{const t={...h,stock:x,quantity:f,id:x.id,img:(0,X.Z)(x)||h.img};t.quantity>x.quantity?_.Am.warning("You cannot order more than ".concat(x.quantity)):(O((0,y.x$)(t)),p(null))},initialValues:{stock:null===(l=h.stock)||void 0===l?void 0:l.id},children:[(0,N.jsxs)(d.Z,{gutter:24,children:[(0,N.jsx)(a.Z,{span:8,children:(0,N.jsx)(R.Z,{src:(0,Y.Z)((0,X.Z)(x)||h.img),alt:null===(r=h.translation)||void 0===r?void 0:r.title,height:200,style:{objectFit:"contain"}})}),(0,N.jsx)(a.Z,{span:16,children:(0,N.jsxs)(T.Z,{title:null===(o=h.translation)||void 0===o?void 0:o.title,children:[(0,N.jsxs)(T.Z.Item,{label:"Price",span:3,children:[(0,N.jsx)("div",{className:null!==x&&void 0!==x&&x.discount?"strike":"",children:(0,Q.Z)(null===x||void 0===x?void 0:x.price,M.symbol)}),null!==x&&void 0!==x&&x.discount?(0,N.jsx)("div",{className:"ml-2 font-weight-bold",children:(0,Q.Z)(null===x||void 0===x?void 0:x.total_price,M.symbol)}):""]}),(0,N.jsx)(T.Z.Item,{label:"In stock",span:3,children:(0,J.Z)(null===x||void 0===x?void 0:x.quantity,h.unit)}),(0,N.jsx)(T.Z.Item,{label:"Tax",span:3,children:(0,Q.Z)(null===x||void 0===x?void 0:x.tax,M.symbol)})]})})]}),null===w||void 0===w||null===(c=w.extras)||void 0===c?void 0:c.map(((e,t)=>(0,N.jsx)("div",{className:"extra-group",children:(0,N.jsx)(V.Z,{className:"extras-select",children:e.map((e=>"color"===e.group.type?(0,N.jsx)("span",{className:"extras-color-wrapper ".concat(C.find((t=>t.id===e.id))?"selected":""),onClick:()=>U(e),children:(0,N.jsx)("i",{className:"extras-color",style:{backgroundColor:e.value}})}):"text"===e.group.type?(0,N.jsx)("span",{className:"extras-text rounded ".concat(C.find((t=>t.id===e.id))?"selected":""),onClick:()=>U(e),children:e.value}):(0,N.jsx)("span",{className:"extras-image rounded ".concat(C.find((t=>t.id===e.id))?"selected":""),onClick:()=>U(e),children:(0,N.jsx)("img",{src:(0,Y.Z)(e.value),alt:"extra"})})))},"extra-group"+t)}))),(0,N.jsx)(d.Z,{gutter:12,className:"mt-3",children:(0,N.jsx)(a.Z,{span:24,children:(0,N.jsxs)(V.Z,{children:[(0,N.jsx)(n.Z,{type:"primary",icon:(0,N.jsx)(L.Z,{}),onClick:function(){1!==f&&(f<=h.min_qty||Z((e=>e-1)))}}),(f||1)*((null===h||void 0===h?void 0:h.interval)||1),null===h||void 0===h||null===(u=h.unit)||void 0===u||null===(v=u.translation)||void 0===v?void 0:v.title,(0,N.jsx)(n.Z,{type:"primary",icon:(0,N.jsx)(P.Z,{}),onClick:function(){f!==(null===x||void 0===x?void 0:x.quantity)&&f!==h.max_qty&&Z((e=>e+1))}})]})})})]})})}var ee=l(95882),te=l(21448);function le(e,t){return t}function ie(){var e,t,l,s;const{t:r}=(0,j.$)(),u=(0,m.I0)(),h=(0,g.s0)(),{orderItems:p,data:x,orderShops:f,total:_,coupons:b}=(0,m.v9)((e=>e.order),m.wU),[k,S]=(0,i.useState)(!1),[w,I]=(0,i.useState)(null),[C,M]=(0,i.useState)(null);(0,q.Z)((()=>{u((0,ee.MW)({perPage:12,currency_id:x.currency.id}))}),[x.currency]),(0,q.Z)((()=>{p.length?function(){const e=function(e){const t=e.map(((e,t)=>({["products[".concat(t,"][id]")]:e.id,["products[".concat(t,"][quantity]")]:e.quantity})));return Object.assign({},...t)}(p),t={currency_id:x.currency.id,...e};S(!0),$.Z.calculate(t).then((e=>{let{data:t}=e;const l=t.products.map((e=>({...p.find((t=>t.id===e.id)),...e})));u((0,y.rU)(l));const i={product_total:t.product_total,product_tax:t.product_tax,order_tax:t.order_tax,order_total:t.order_total};u((0,y.rU)(i))})).finally((()=>S(!1)))}():u((0,y.pX)())}),[p,x.currency]);return(0,N.jsxs)("div",{className:"order-items",children:[k&&(0,N.jsx)("div",{className:"loader",children:(0,N.jsx)(o.Z,{})}),(0,N.jsxs)(d.Z,{gutter:24,className:"mt-4",children:[(0,N.jsx)(a.Z,{span:24,children:f.map((e=>{var t,l,i,s,d,a,o;return(0,N.jsxs)(c.Z,{className:"shop-card",children:[e.products.map((e=>{var t,l;return(0,N.jsxs)(c.Z,{className:"position-relative",children:[(0,N.jsx)(A.Z,{className:"close-order",onClick:()=>u((0,y.Sg)(e))}),(0,N.jsxs)(V.Z,{className:"mr-3",children:[(0,N.jsx)("div",{className:"order-item-img",children:(0,N.jsx)("img",{src:(0,Y.Z)(e.img),alt:null===(t=e.translation)||void 0===t?void 0:t.title})}),(0,N.jsx)(E.Z,{title:(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{className:"cursor-pointer white-space-wrap",onClick:()=>(e=>{u((0,Z.bL)({id:"product-".concat(e.uuid),url:"seller/product/".concat(e.uuid),name:"Product edit"})),h("/seller/product/".concat(e.uuid))})(e),children:null===(l=e.translation)||void 0===l?void 0:l.title}),(0,N.jsx)("div",{className:"product-price",children:(0,Q.Z)(e.price_without_tax,x.currency.symbol)})]}),description:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{children:["Quantity: ",e.quantity]}),(0,N.jsx)(V.Z,{className:"mt-2",children:e.stock.extras.map((e=>"color"===e.group.type?(0,N.jsx)("span",{className:"extras-color",style:{backgroundColor:e.value}}):"text"===e.group.type?(0,N.jsx)("span",{className:"extras-text rounded",children:e.value}):(0,N.jsx)("img",{src:(0,Y.Z)(e.value),alt:"extra",className:"extras-image rounded"})))})]})})]})]},e.id)})),(0,N.jsxs)("div",{className:"d-flex align-items-center justify-content-between",children:[(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("img",{src:(0,Y.Z)(e.logo_img),alt:"shop logo",width:40,className:"rounded-circle"}),(0,N.jsx)("div",{children:null===(t=e.translation)||void 0===t?void 0:t.title})]}),(0,N.jsxs)(V.Z,{children:[(0,N.jsx)(v.Z,{placeholder:r("coupon"),addonAfter:null!==(l=b.find((t=>t.shop_id===e.id)))&&void 0!==l&&l.verified?(0,N.jsx)(B.Z,{style:{color:"#18a695"}}):null,defaultValue:null===(i=b.find((t=>t.shop_id===e.id)))||void 0===i?void 0:i.coupon,onBlur:t=>{var l;return u((0,y.cp)({coupon:t.target.value,user_id:null===(l=x.user)||void 0===l?void 0:l.value,shop_id:e.id,verified:!1}))}}),(0,N.jsx)(n.Z,{onClick:()=>function(e){let t=b.find((t=>t.shop_id===e));t&&(M(e),te.Z.checkCoupon(t).then((t=>u((0,y.NS)({shop_id:e,price:t.data.price,verified:!0})))).catch((()=>u((0,y.NS)({shop_id:e,price:0,verified:!1})))).finally((()=>M(null))))}(e.id),loading:C===e.id,children:r("check.coupon")})]}),(0,N.jsxs)("div",{className:"mt-2 text-right shop-total",children:[(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("p",{className:"font-weight-bold",children:"Product tax:"}),(0,N.jsx)("p",{children:(0,Q.Z)(D(e).productTax,null===(s=x.currency)||void 0===s?void 0:s.symbol)})]}),(0,N.jsx)("div",{}),(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("p",{className:"font-weight-bold",children:"Shop tax:"}),(0,N.jsx)("p",{children:(0,Q.Z)(D(e).shopTax,null===(d=x.currency)||void 0===d?void 0:d.symbol)})]}),(0,N.jsx)("div",{}),(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("p",{className:"font-weight-bold",children:"Delivery fee:"}),(0,N.jsx)("p",{children:(0,Q.Z)(D(e,x.deliveries).deliveryFee,null===(a=x.currency)||void 0===a?void 0:a.symbol)})]}),(0,N.jsx)("div",{}),(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("p",{className:"font-weight-bold",children:"Total:"}),(0,N.jsx)("p",{children:(0,Q.Z)(D(e,x.deliveries).total,null===(o=x.currency)||void 0===o?void 0:o.symbol)})]})]})]})]},e.uuid)}))}),(0,N.jsx)(a.Z,{span:24,children:(0,N.jsx)("div",{className:"order-info",children:(0,N.jsxs)(T.Z,{bordered:!0,className:"order-info-container",children:[(0,N.jsx)(T.Z.Item,{label:"Product total",children:(0,Q.Z)(_.product_total,null===(e=x.currency)||void 0===e?void 0:e.symbol)}),(0,N.jsx)(T.Z.Item,{label:"Product tax",children:(0,Q.Z)(_.product_tax,null===(t=x.currency)||void 0===t?void 0:t.symbol)}),(0,N.jsx)(T.Z.Item,{label:"Shop tax",children:(0,Q.Z)(_.order_tax,null===(l=x.currency)||void 0===l?void 0:l.symbol)}),(0,N.jsx)(T.Z.Item,{label:"Order total",labelStyle:{fontWeight:700},children:(0,N.jsx)("span",{style:{fontWeight:700},children:(0,Q.Z)(le(x.deliveries,_.order_total),null===(s=x.currency)||void 0===s?void 0:s.symbol)})})]})})})]}),w&&(0,N.jsx)(K,{extrasModal:w,setExtrasModal:I})]})}var se=l(41481);const re=e=>{let{form:t}=e;const[l,s]=(0,i.useState)(null),[r,n]=(0,i.useState)(null),[u,v]=(0,i.useState)(null),[h,p]=(0,i.useState)(null),y=(0,m.I0)(),{data:j}=(0,m.v9)((e=>e.order),m.wU),{products:f,loading:Z}=(0,m.v9)((e=>e.product),m.wU);(0,q.Z)((()=>{const e={perPage:10,page:1,brand_id:null===l||void 0===l?void 0:l.value,category_id:null===r||void 0===r?void 0:r.value,search:u};y((0,ee.MW)(e))}),[l,r,u]);return(0,N.jsxs)(c.Z,{title:"Order details",extra:(0,N.jsxs)(V.Z,{children:[(0,N.jsx)(x.h,{placeholder:"Select category",fetchOptions:async function(e){const t={search:e};return z.Z.search(t).then((e=>{let{data:t}=e;return t.map((e=>{var t;return{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}}))}))},style:{minWidth:150},onChange:e=>n(e),value:r}),(0,N.jsx)(x.h,{placeholder:"Select brand",fetchOptions:async function(e){return F.Z.search(e).then((e=>{let{data:t}=e;return t.map((e=>({label:e.title,value:e.id})))}))},style:{minWidth:150},onChange:e=>s(e),value:l})]}),children:[(0,N.jsx)("div",{className:"d-flex justify-content-end mb-4",children:(0,N.jsx)(se.Z,{placeholder:"Search...",handleChange:v})}),(0,N.jsxs)("div",{className:"products-row order-items",children:[f.length?f.map((e=>{var t,l,i;return(0,N.jsxs)(c.Z,{className:"products-col",cover:(0,N.jsx)("img",{alt:null===(t=e.translation)||void 0===t?void 0:t.title,src:(0,Y.Z)(e.img)}),onClick:()=>(e=>{j.currency?p(e):_.Am.warning("Please, select currency")})(e),children:[(0,N.jsx)(E.Z,{title:null===(l=e.translation)||void 0===l?void 0:l.title,description:null===(i=e.stock)||void 0===i?void 0:i.price}),(0,N.jsx)("div",{className:"preview",children:(0,N.jsx)(P.Z,{})})]},e.id)})):(0,N.jsx)(d.Z,{children:(0,N.jsx)(a.Z,{span:24,children:(0,N.jsx)(O.Z,{id:"nosell"})})}),Z&&(0,N.jsx)("div",{className:"loader",children:(0,N.jsx)(o.Z,{})})]}),h&&(0,N.jsx)(K,{extrasModal:h,setExtrasModal:p}),(0,N.jsx)(ie,{form:t})]})};var ne=l(78508),de=l(2337),ae=l(31774),oe=l(84261),ce=l(4014);const ue=e=>{var t,l,s,r,d,a,u,v,h,p,x,m,y,f,Z,g,_,b;let{orderId:k,handleClose:S}=e;const{t:w}=(0,j.$)(),[I,C]=(0,i.useState)(!1),[q,M]=(0,i.useState)(null),[O,U]=(0,i.useState)([]);return(0,i.useEffect)((()=>{k&&(C(!0),$.Z.getById(k).then((e=>{M(e.data);const t=e.data.details.map((e=>e.order_stocks.map((t=>({...t.stock,...t,shop_id:e.shop_id}))))).flat();U(t)})).finally((()=>C(!1))))}),[k]),(0,N.jsx)(W.Z,{visible:!!k,title:"Order created successfully",onOk:S,onCancel:S,footer:[(0,N.jsx)(n.Z,{onClick:S,children:w("back")}),(0,N.jsxs)(n.Z,{type:"primary",onClick:()=>window.print(),children:[(0,N.jsx)(ae.Z,{type:"printer"}),(0,N.jsx)("span",{className:"ml-1",children:w("print")})]})],style:{minWidth:"80vw"},children:(0,N.jsx)("div",{className:"py-4",children:I?(0,N.jsx)("div",{className:"w-100 text-center",children:(0,N.jsx)(o.Z,{})}):(0,N.jsxs)(c.Z,{children:[(0,N.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[(0,N.jsxs)("div",{children:[(0,N.jsxs)("h2",{className:"mb-1 font-weight-semibold",children:[w("invoice")," #",null===q||void 0===q?void 0:q.id]}),(0,N.jsx)("p",{children:H()(null===q||void 0===q?void 0:q.created_at).format("DD/M/YYYY")}),(0,N.jsx)("address",{children:(0,N.jsxs)("p",{children:[(0,N.jsxs)("span",{children:[w("delivery.type"),":"," ",null===q||void 0===q||null===(t=q.details[0])||void 0===t||null===(l=t.delivery_type)||void 0===l||null===(s=l.translation)||void 0===s?void 0:s.title]}),(0,N.jsx)("br",{}),(0,N.jsxs)("span",{children:[w("delivery.address"),":"," ",null===q||void 0===q||null===(r=q.details[0])||void 0===r||null===(d=r.delivery_address)||void 0===d?void 0:d.address]}),(0,N.jsx)("br",{}),(0,N.jsxs)("span",{children:[w("delivery.date"),": ",null===q||void 0===q||null===(a=q.details[0])||void 0===a?void 0:a.delivery_date," ",null===q||void 0===q||null===(u=q.details[0])||void 0===u?void 0:u.delivery_time]}),(0,N.jsx)("br",{}),(0,N.jsxs)("span",{children:[w("note"),": ",null===q||void 0===q?void 0:q.note]})]})})]}),(0,N.jsx)("address",{children:(0,N.jsxs)("p",{children:[(0,N.jsxs)("span",{className:"font-weight-semibold text-dark font-size-md",children:[null===q||void 0===q||null===(v=q.user)||void 0===v?void 0:v.firstname," ",null===q||void 0===q||null===(h=q.user)||void 0===h?void 0:h.lastname]}),(0,N.jsx)("br",{}),(0,N.jsxs)("span",{children:[w("phone"),":"," ",null!==q&&void 0!==q&&null!==(p=q.user)&&void 0!==p&&p.phone?(0,oe.Z)(null===q||void 0===q||null===(x=q.user)||void 0===x?void 0:x.phone):w("no.phone")]}),(0,N.jsx)("br",{}),(0,N.jsxs)("span",{children:[w("email"),":"," ",null!==q&&void 0!==q&&null!==(m=q.user)&&void 0!==m&&m.email?(0,ce.Z)(null===q||void 0===q||null===(y=q.user)||void 0===y?void 0:y.email):w("no.email")]})]})})]}),(0,N.jsxs)("div",{className:"mt-4",children:[(0,N.jsxs)(ne.Z,{scroll:{x:!0},dataSource:O,pagination:!1,className:"mb-5",children:[(0,N.jsx)(de.Z,{title:"No.",dataIndex:"id"},"id"),(0,N.jsx)(de.Z,{title:"Product",dataIndex:"product",render:e=>{var t;return null===e||void 0===e||null===(t=e.translation)||void 0===t?void 0:t.title}},"product"),(0,N.jsx)(de.Z,{title:w("quantity"),dataIndex:"quantity",render:(e,t)=>{var l,i,s,r,n,d;return(0,N.jsxs)("span",{children:[t.quantity*((null===t||void 0===t||null===(l=t.stock)||void 0===l||null===(i=l.product)||void 0===i?void 0:i.interval)||1),null===t||void 0===t||null===(s=t.stock)||void 0===s||null===(r=s.product)||void 0===r||null===(n=r.unit)||void 0===n||null===(d=n.translation)||void 0===d?void 0:d.title]})}},"quantity"),(0,N.jsx)(de.Z,{title:w("discount"),dataIndex:"discount",render:e=>{var t;return(0,Q.Z)(e,null===q||void 0===q||null===(t=q.currency)||void 0===t?void 0:t.symbol)}},"discount"),(0,N.jsx)(de.Z,{title:w("price"),dataIndex:"total_price",render:e=>{var t;return(0,Q.Z)(e,null===q||void 0===q||null===(t=q.currency)||void 0===t?void 0:t.symbol)}},"total_price")]}),(0,N.jsx)("div",{className:"d-flex justify-content-end",children:(0,N.jsxs)("div",{className:"text-right ",children:[(0,N.jsxs)("div",{className:"border-bottom",children:[(0,N.jsxs)("p",{className:"mb-2",children:[(0,N.jsxs)("span",{children:[w("sub-total.amount"),": "]}),(0,Q.Z)(null===q||void 0===q?void 0:q.details.reduce(((e,t)=>e+t.price),0),null===q||void 0===q||null===(f=q.currency)||void 0===f?void 0:f.symbol)]}),(0,N.jsxs)("p",{children:[w("delivery.price"),":"," ",(0,Q.Z)(null===q||void 0===q?void 0:q.details.reduce(((e,t)=>e+t.delivery_fee),0),null===q||void 0===q||null===(Z=q.currency)||void 0===Z?void 0:Z.symbol)]}),(0,N.jsxs)("p",{children:[w("tax"),":"," ",(0,Q.Z)(null===q||void 0===q?void 0:q.details.reduce(((e,t)=>e+t.tax),0),null===q||void 0===q||null===(g=q.currency)||void 0===g?void 0:g.symbol)]}),(0,N.jsxs)("p",{children:[w("coupon"),":"," ",(0,Q.Z)(null===q||void 0===q?void 0:q.details.reduce(((e,t)=>{var l;return e+(null===(l=t.coupon)||void 0===l?void 0:l.price)}),0),null===q||void 0===q||null===(_=q.currency)||void 0===_?void 0:_.symbol)]})]}),(0,N.jsxs)("h2",{className:"font-weight-semibold mt-3",children:[(0,N.jsxs)("span",{className:"mr-1",children:[w("grand.total"),": "]}),(0,Q.Z)(null===q||void 0===q?void 0:q.price,null===q||void 0===q||null===(b=q.currency)||void 0===b?void 0:b.symbol)]})]})})]})]})})})};var ve=l(7370),he=l(22054),pe=l(1003);function xe(){const{t:e}=(0,j.$)(),[t]=s.Z.useForm(),l=(0,m.I0)(),{id:c}=(0,g.UO)(),u=(0,g.s0)(),[v,h]=(0,i.useState)(!1),[p,x]=(0,i.useState)(null),[f,_]=(0,i.useState)(!1),{orderShops:b,data:k,total:w,coupons:I}=(0,m.v9)((e=>e.order),m.wU),{currencies:C}=(0,m.v9)((e=>e.currency),m.wU),{activeMenu:q}=(0,m.v9)((e=>e.menu),m.wU);function M(e){return{label:e.firstname+" "+(e.lastname||""),value:e.id}}function O(e){var t;return e?{label:null===(t=e.translation)||void 0===t?void 0:t.title,value:e.id}:null}(0,i.useEffect)((()=>()=>{const e=t.getFieldsValue(!0),i={...e,deliveries:e.deliveries.map((e=>({...e,delivery_date:e.delivery_date?H()(e.delivery_date).format("YYYY-MM-DD"):void 0})))};l((0,y.oM)(i))}),[]),(0,i.useEffect)((()=>{q.refetch&&(_(!0),ve.Z.getById(c).then((e=>{var i;const s=e.data;var r;l((0,y.dY)(s.currency)),l((0,y.oM)({deliveries:(r=s.details,r.map((e=>({delivery:{label:e.delivery_type.translation.title,value:e.delivery_type.id},delivery_date:e.delivery_date,delivery_time:e.delivery_time,shop_id:e.delivery_type.shop_id,delivery_fee:e.delivery_fee}))))}));const n=s.details.flatMap((e=>e.order_stocks.map((e=>({...e.stock.product,...e.stock,quantity:e.quantity,stock:e.stock,img:(0,X.Z)(e.stock)||e.stock.product.img,product:void 0})))));var d;l((0,y.B4)(n)),t.setFieldsValue({user:M(s.user),currency_id:s.currency.id,address:(d=s.details[0].delivery_address,d?{label:d.address,value:d.id}:null),payment_type:O(null===(i=s.details[0].transaction)||void 0===i?void 0:i.payment_system),note:s.note})})).finally((()=>{_(!1),l((0,Z.A_)(q))})))}),[q.refetch]);const V=e=>{const t={payment_sys_id:e.payment_type};h(!0),ve.Z.update(c,e).then((e=>function(e,t){pe.Z.create(e,t).then((e=>{x(e.data.id),l((0,y.bn)())})).finally((()=>h(!1)))}(e.data.id,t))).catch((()=>h(!1)))};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(r.Z,{title:e("edit.order"),extra:(0,N.jsx)(n.Z,{type:"primary",loading:v,onClick:()=>t.submit(),children:e("save")})}),(0,N.jsxs)(s.Z,{name:"order-form",form:t,layout:"vertical",onFinish:e=>{var t,l;const i=e.deliveries.map((t=>({delivery_type_id:t.delivery.value,shop_id:t.shop_id,delivery_address_id:e.address.value,delivery_date:H()(t.delivery_date).format("YYYY-MM-DD"),delivery_time:t.delivery_time,delivery_fee:q.data.find((e=>e.id===t.shop_id)).deliveries.find((e=>e.id===t.delivery.value)).price}))),s=i.reduce(((e,t)=>e+t.delivery_fee),0),r=b.map((e=>{var t;return{...i.find((t=>t.shop_id===e.id)),tax:D(e).shopTax,coupon:null===(t=I.find((t=>t.shop_id===e.id)))||void 0===t?void 0:t.coupon,products:e.products.map((e=>({id:e.id,price:e.price,qty:e.qty,tax:e.tax,discount:e.discount,total_price:e.total_price})))}})),n=s+w.order_total,d={shops:r,user_id:null===(t=e.user)||void 0===t?void 0:t.value,total:n,currency_id:e.currency_id,rate:null===(l=C.find((t=>t.id===e.currency_id)))||void 0===l?void 0:l.rate,payment_type:e.payment_type.value,note:e.note};V(d)},className:"order-add",initialValues:{user:k.user||null,address:k.address||null,currency_id:k.currency.id,payment_type:k.payment_type||null,deliveries:k.deliveries.map((e=>({...e,delivery_date:H()(e.delivery_date)}))),note:k.note},children:[(0,N.jsxs)(d.Z,{gutter:24,hidden:f,children:[(0,N.jsx)(a.Z,{span:16,children:(0,N.jsx)(re,{form:t})}),(0,N.jsxs)(a.Z,{span:8,children:[(0,N.jsx)(S,{form:t}),(0,N.jsx)(U,{form:t})]})]}),f&&(0,N.jsx)("div",{className:"loader",children:(0,N.jsx)(o.Z,{})})]}),p?(0,N.jsx)(ue,{orderId:p,handleClose:()=>{x(null);const e="orders";l((0,Z.ph)({...q,nextUrl:e})),u("/".concat(e)),l((0,he.AU)())}}):""]})}},8846:(e,t,l)=>{l.d(t,{Z:()=>a});var i=l(1413),s=l(47313);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};var n=l(17469),d=function(e,t){return s.createElement(n.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:r}))};d.displayName="MinusOutlined";const a=s.forwardRef(d)},55768:(e,t,l)=>{l.d(t,{Z:()=>a});var i=l(1413),s=l(47313);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"};var n=l(17469),d=function(e,t){return s.createElement(n.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:r}))};d.displayName="PlusCircleOutlined";const a=s.forwardRef(d)},31774:(e,t,l)=>{l.d(t,{Z:()=>a});var i=l(1413),s=l(47313);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"};var n=l(17469),d=function(e,t){return s.createElement(n.Z,(0,i.Z)((0,i.Z)({},e),{},{ref:t,icon:r}))};d.displayName="PrinterOutlined";const a=s.forwardRef(d)},2337:(e,t)=>{t.Z=void 0;var l=function(e){return null};t.Z=l}}]);